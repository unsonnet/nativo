(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[81],{918:(e,a,s)=>{"use strict";s.r(a),s.d(a,{default:()=>X});var r=s(5155),t=s(2115),i=s(63),l=s(1847);let o=(0,l.A)("info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);function c(e){return e?e.charAt(0).toUpperCase()+e.slice(1).toLowerCase():e||""}function n(e){let{report:a}=e,{reference:s}=a,t=s.formats[0],i=[{label:"Type",value:c(s.category.type)},{label:"Material",value:c(s.category.material)},{label:"Look",value:c(s.category.look)},{label:"Texture",value:c(s.category.texture)},{label:"Finish",value:c(s.category.finish)},{label:"Edge",value:c(s.category.edge)}];return(0,r.jsx)("div",{className:"report-info-header",children:(0,r.jsxs)("div",{className:"report-info-header__content",children:[(0,r.jsx)("div",{className:"report-info-header__section report-info-header__section--title",children:(0,r.jsxs)("div",{className:"report-info-header__title-custom",children:[(0,r.jsx)(o,{className:"w-4 h-4"}),"Reference Info"]})}),(0,r.jsxs)("div",{className:"report-info-header__section",children:[(0,r.jsx)("label",{className:"report-info-header__label",children:"Dimensions"}),(0,r.jsx)("div",{className:"report-info-header__value",children:(()=>{if(!t)return"Unknown";let{length:e,width:a,thickness:s}=t;if((null==e?void 0:e.unit)!=="none"&&(null==a?void 0:a.unit)!=="none"){let r=(null==e?void 0:e.val)?"".concat(e.val,'"'):"unset",t=(null==a?void 0:a.val)?"".concat(a.val,'"'):"unset",i=(null==s?void 0:s.val)?"".concat(s.val,"mm"):null;return i?"".concat(r," x ").concat(t," x ").concat(i):"".concat(r," x ").concat(t)}{let r=(null==e?void 0:e.val)?"".concat(e.val):"unset",t=(null==a?void 0:a.val)?"".concat(a.val):"unset",i=(null==s?void 0:s.val)?"".concat(s.val,"mm"):null;return i?"".concat(r," : ").concat(t," x ").concat(i):"".concat(r," : ").concat(t)}})()})]}),i.map((e,a)=>(0,r.jsxs)("div",{className:"report-info-header__section",children:[(0,r.jsx)("label",{className:"report-info-header__label",children:e.label}),(0,r.jsx)("div",{className:"report-info-header__value ".concat(e.value?"":"report-info-header__value--unset"),children:e.value||"unset"})]},a))]})})}let d=(0,l.A)("images",[["path",{d:"m22 11-1.296-1.296a2.4 2.4 0 0 0-3.408 0L11 16",key:"9kzy35"}],["path",{d:"M4 8a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2",key:"1t0f0t"}],["circle",{cx:"13",cy:"7",r:"1",fill:"currentColor",key:"1obus6"}],["rect",{x:"8",y:"2",width:"14",height:"14",rx:"2",key:"1gvhby"}]]),h=(0,l.A)("chevron-left",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]),u=(0,l.A)("chevron-right",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);var m=s(6547);function p(e){var a;let{images:s}=e,[i,l]=(0,t.useState)(0);if(!s||0===s.length)return(0,r.jsx)("div",{className:"image-gallery",children:(0,r.jsx)("div",{className:"image-gallery__empty",children:(0,r.jsx)("p",{children:"No images available"})})});let o=s.length>1;return(0,r.jsxs)("div",{className:"image-gallery",children:[(0,r.jsx)("div",{className:"search-filters__header search-filters__header--strip-top",children:(0,r.jsxs)("h3",{className:"search-filters__title",children:[(0,r.jsx)(d,{className:"w-4 h-4"}),"Reference Images"]})}),(0,r.jsxs)("div",{className:"image-gallery__viewer",children:[o&&(0,r.jsx)("button",{onClick:()=>{l(e=>e>0?e-1:s.length-1)},className:"image-gallery__nav image-gallery__nav--left","aria-label":"Previous image",children:(0,r.jsx)(h,{className:"w-5 h-5"})}),(0,r.jsx)("div",{className:"image-gallery__main",children:(0,r.jsx)(m.H,{src:null==(a=s[i])?void 0:a.url,alt:"Product image ".concat(i+1),fill:!0,className:"image-gallery__main-image",sizes:"280px",unoptimized:!0})}),o&&(0,r.jsx)("button",{onClick:()=>{l(e=>e<s.length-1?e+1:0)},className:"image-gallery__nav image-gallery__nav--right","aria-label":"Next image",children:(0,r.jsx)(u,{className:"w-5 h-5"})}),o&&(0,r.jsx)("div",{className:"image-gallery__indicators",children:s.map((e,a)=>(0,r.jsx)("button",{onClick:()=>{l(a)},className:"image-gallery__dot ".concat(i===a?"image-gallery__dot--active":""),"aria-label":"Go to image ".concat(a+1)},a))})]})]})}let v=(0,l.A)("sliders-vertical",[["path",{d:"M10 8h4",key:"1sr2af"}],["path",{d:"M12 21v-9",key:"17s77i"}],["path",{d:"M12 8V3",key:"13r4qs"}],["path",{d:"M17 16h4",key:"h1uq16"}],["path",{d:"M19 12V3",key:"o1uvq1"}],["path",{d:"M19 21v-5",key:"qua636"}],["path",{d:"M3 14h4",key:"bcjad9"}],["path",{d:"M5 10V3",key:"cb8scm"}],["path",{d:"M5 21v-7",key:"1w1uti"}]]),f=(0,l.A)("search",[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]]);function _(e){var a,s,i,l,o,c,n,d,h,u,m,p,_;let{referenceProduct:x,onSearch:y,isSearching:g,filters:j,onFiltersChange:N}=e,b=null==(a=x.formats)?void 0:a[0],w=(null==b||null==(s=b.length)?void 0:s.unit)!=="none"&&(null==b||null==(i=b.width)?void 0:i.unit)!=="none",k=null==b||null==(l=b.length)?void 0:l.val,S=null==b||null==(o=b.width)?void 0:o.val,P=null==b||null==(c=b.thickness)?void 0:c.val,C=((null==b||null==(n=b.length)?void 0:n.unit)==="none"||(null==b||null==(d=b.width)?void 0:d.unit)==="none")&&k&&S,I=k&&S&&(null==b||null==(p=b.length)?void 0:p.val)&&(null==b||null==(_=b.width)?void 0:_.val)?b.length.val/b.width.val:null,F=()=>({maxLengthDiff:1,maxWidthDiff:1,maxThicknessDiff:P?1:void 0,aspectRatioTolerance:2,colorPrimarySimilarity:50,colorSecondarySimilarity:50,patternPrimarySimilarity:50,patternSecondarySimilarity:50,categories:{type:x.category.type?[x.category.type]:[],material:x.category.material?[x.category.material]:[]}}),[M,A]=(0,t.useState)(F),E=j||M,R=(e,a)=>{let s={...E,[e]:a};N?N(s):A(s)};return(0,r.jsxs)("div",{className:"search-filters",children:[(0,r.jsxs)("div",{className:"search-filters__header",children:[(0,r.jsxs)("h3",{className:"search-filters__title",children:[(0,r.jsx)(v,{className:"w-4 h-4"}),"Filters"]}),(0,r.jsx)("button",{onClick:()=>{let e=F();N?N(e):A(e)},className:"search-filters__reset",children:"Reset"})]}),(0,r.jsxs)("div",{className:"search-filters__content",children:[(0,r.jsxs)("div",{className:"search-filters__section",children:[(0,r.jsx)("h4",{className:"search-filters__section-title",children:"Dimension Similarity"}),C&&(0,r.jsxs)("div",{className:"search-filters__field",children:[(0,r.jsxs)("div",{className:"search-filters__label-container",children:[(0,r.jsx)("label",{className:"search-filters__label",children:"Aspect Ratio Tolerance (%)"}),(()=>{let e=(()=>{if(I){var e,a;let s=(null!=(e=E.aspectRatioTolerance)?e:0)/100,r=I*(1-s),t=I*(1+s);return{min:r.toFixed(2),max:t.toFixed(2),reference:I.toFixed(2),tolerancePercent:null!=(a=E.aspectRatioTolerance)?a:0}}return null})();return e?(0,r.jsxs)("div",{className:"search-filters__reference-note",children:[e.reference," \xb1 ",e.tolerancePercent,"% (",e.min," - ",e.max,")"]}):null})()]}),(0,r.jsx)("input",{type:"number",min:"0",max:"100",step:"0.1",value:null!=(m=E.aspectRatioTolerance)?m:"",onKeyDown:e=>{-1===[8,9,27,13,46,110,190].indexOf(e.keyCode)&&(65!==e.keyCode||!0!==e.ctrlKey)&&(67!==e.keyCode||!0!==e.ctrlKey)&&(86!==e.keyCode||!0!==e.ctrlKey)&&(88!==e.keyCode||!0!==e.ctrlKey)&&(!(e.keyCode>=35)||!(e.keyCode<=39))&&(e.shiftKey||e.keyCode<48||e.keyCode>57)&&(e.keyCode<96||e.keyCode>105)&&e.preventDefault()},onChange:e=>{let a=e.target.value;if(""===a)R("aspectRatioTolerance",void 0);else{let e=parseFloat(a);!isNaN(e)&&e>=0&&e<=100&&R("aspectRatioTolerance",e)}},onBlur:e=>{(""===e.target.value||void 0===E.aspectRatioTolerance)&&R("aspectRatioTolerance",2)},className:"form-control"})]}),w&&k&&(0,r.jsxs)("div",{className:"search-filters__field",children:[(0,r.jsxs)("label",{className:"search-filters__label",children:["Δ Length (",(null==b||null==(h=b.length)?void 0:h.unit)||"in",")"]}),(0,r.jsx)("input",{type:"number",min:"0",max:"10",step:"0.5",value:E.maxLengthDiff||"",onChange:e=>{let a=""===e.target.value?0:parseFloat(e.target.value);!isNaN(a)&&a>=0&&a<=10&&R("maxLengthDiff",a)},className:"form-control",placeholder:"1.0"})]}),w&&S&&(0,r.jsxs)("div",{className:"search-filters__field",children:[(0,r.jsxs)("label",{className:"search-filters__label",children:["Δ Width (",(null==b||null==(u=b.width)?void 0:u.unit)||"in",")"]}),(0,r.jsx)("input",{type:"number",min:"0",max:"10",step:"0.5",value:E.maxWidthDiff||"",onChange:e=>{let a=""===e.target.value?0:parseFloat(e.target.value);!isNaN(a)&&a>=0&&a<=10&&R("maxWidthDiff",a)},className:"form-control",placeholder:"1.0"})]}),P&&(0,r.jsxs)("div",{className:"search-filters__field",children:[(0,r.jsx)("label",{className:"search-filters__label",children:"Δ Depth (mm)"}),(0,r.jsx)("input",{type:"number",min:"0",max:"20",step:"0.5",value:E.maxThicknessDiff||"",onChange:e=>{let a=""===e.target.value?0:parseFloat(e.target.value);!isNaN(a)&&a>=0&&a<=20&&R("maxThicknessDiff",a)},className:"form-control",placeholder:"1.0"})]})]}),(0,r.jsxs)("div",{className:"search-filters__section",children:[(0,r.jsx)("h4",{className:"search-filters__section-title",children:"Color Similarity"}),(0,r.jsxs)("div",{className:"search-filters__field search-filters__field--vertical",children:[(0,r.jsxs)("div",{className:"slider-label-row",children:[(0,r.jsx)("label",{className:"search-filters__label",children:"Primary"}),(0,r.jsxs)("span",{className:"slider-value",children:[E.colorPrimarySimilarity,"%"]})]}),(0,r.jsx)("input",{type:"range",min:"0",max:"100",value:E.colorPrimarySimilarity,onChange:e=>R("colorPrimarySimilarity",parseInt(e.target.value)),className:"slider-control"})]}),(0,r.jsxs)("div",{className:"search-filters__field search-filters__field--vertical",children:[(0,r.jsxs)("div",{className:"slider-label-row",children:[(0,r.jsx)("label",{className:"search-filters__label",children:"Secondary"}),(0,r.jsxs)("span",{className:"slider-value",children:[E.colorSecondarySimilarity,"%"]})]}),(0,r.jsx)("input",{type:"range",min:"0",max:"100",value:E.colorSecondarySimilarity,onChange:e=>R("colorSecondarySimilarity",parseInt(e.target.value)),className:"slider-control"})]})]}),(0,r.jsxs)("div",{className:"search-filters__section",children:[(0,r.jsx)("h4",{className:"search-filters__section-title",children:"Pattern Similarity"}),(0,r.jsxs)("div",{className:"search-filters__field search-filters__field--vertical",children:[(0,r.jsxs)("div",{className:"slider-label-row",children:[(0,r.jsx)("label",{className:"search-filters__label",children:"Primary"}),(0,r.jsxs)("span",{className:"slider-value",children:[E.patternPrimarySimilarity,"%"]})]}),(0,r.jsx)("input",{type:"range",min:"0",max:"100",value:E.patternPrimarySimilarity,onChange:e=>R("patternPrimarySimilarity",parseInt(e.target.value)),className:"slider-control"})]}),(0,r.jsxs)("div",{className:"search-filters__field search-filters__field--vertical",children:[(0,r.jsxs)("div",{className:"slider-label-row",children:[(0,r.jsx)("label",{className:"search-filters__label",children:"Secondary"}),(0,r.jsxs)("span",{className:"slider-value",children:[E.patternSecondarySimilarity,"%"]})]}),(0,r.jsx)("input",{type:"range",min:"0",max:"100",value:E.patternSecondarySimilarity,onChange:e=>R("patternSecondarySimilarity",parseInt(e.target.value)),className:"slider-control"})]})]}),(0,r.jsxs)("div",{className:"search-filters__section",children:[(0,r.jsx)("h4",{className:"search-filters__section-title",children:"Categories"}),Object.entries({type:["Hardwood","Laminate","Vinyl","Tile","Carpet"],material:["Oak","Maple","Cherry","Pine","Bamboo","Ceramic","Porcelain"],look:["Traditional","Modern","Rustic","Contemporary","Industrial"],texture:["Smooth","Textured","Embossed","Hand-scraped","Wire-brushed"],finish:["Matte","Satin","Gloss","Semi-gloss","Natural"],edge:["Square","Beveled","Micro-beveled","Eased","Pillowed"]}).map(e=>{let[a,s]=e;return(0,r.jsxs)("div",{className:"search-filters__field search-filters__field--vertical",children:[(0,r.jsx)("label",{className:"search-filters__label",children:a.charAt(0).toUpperCase()+a.slice(1)}),(0,r.jsx)("div",{className:"checkbox-group",children:s.map(e=>(0,r.jsxs)("label",{className:"checkbox-label",children:[(0,r.jsx)("input",{type:"checkbox",checked:(E.categories[a]||[]).includes(e),onChange:s=>((e,a,s)=>{let r={...E,categories:{...E.categories,[e]:s?[...E.categories[e]||[],a]:(E.categories[e]||[]).filter(e=>e!==a)}};N?N(r):A(r)})(a,e,s.target.checked),className:"checkbox-input"}),(0,r.jsx)("span",{className:"checkbox-custom"}),e]},e))})]},a)})]})]}),(0,r.jsx)("div",{className:"search-filters__footer",children:(0,r.jsxs)("button",{onClick:()=>{y(E)},disabled:g,className:"button button--primary search-filters__search-btn",children:[(0,r.jsx)(f,{className:"w-4 h-4"}),g?"Searching...":"Search Similar Products"]})})]})}let x=(0,l.A)("download",[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]]),y=(0,l.A)("grid-3x3",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"M15 3v18",key:"14nvp0"}]]),g=(0,l.A)("heart",[["path",{d:"M2 9.5a5.5 5.5 0 0 1 9.591-3.676.56.56 0 0 0 .818 0A5.49 5.49 0 0 1 22 9.5c0 2.29-1.5 4-3 5.5l-5.492 5.313a2 2 0 0 1-3 .019L5 15c-1.5-1.5-3-3.2-3-5.5",key:"mvr1a0"}]]),j=(0,l.A)("package",[["path",{d:"M11 21.73a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73z",key:"1a0edw"}],["path",{d:"M12 22V12",key:"d0xqtd"}],["polyline",{points:"3.29 7 12 12 20.71 7",key:"ousv84"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}]]);var N=s(4609);function b(e){return"".concat("k9.session.favorites",".").concat(e)}class w{static async syncFavoritesToDatabase(e,a){try{let s=await N.reportsApiService.syncFavorites(e,a);if(200!==s.status)throw Error(s.error||"Failed to sync favorites");console.log("[API] Synced favorites for report ".concat(e,":"),a)}catch(e){throw console.error("[API] Failed to sync favorites:",e),e}}static async updateFavoriteStatus(e,a,s){try{let r=await N.reportsApiService.updateFavoriteStatus(e,a,s);if(200!==r.status)throw Error(r.error||"Failed to update favorite status");console.log("[API] Updated favorite status for ".concat(a," in report ").concat(e,": ").concat(s))}catch(e){throw console.error("[API] Failed to update favorite status:",e),e}}static async loadFavoritesFromDatabase(e){try{let a=await N.reportsApiService.getReport(e);if(200===a.status)return a.body.favorites||[];return console.warn("[API] Failed to load report ".concat(e,", using empty favorites")),[]}catch(e){return console.error("[API] Failed to load favorites from database:",e),[]}}}function k(e){try{let a=sessionStorage.getItem(b(e));if(!a)return[];return JSON.parse(a).map(e=>e.id)}catch(e){return console.warn("Failed to load session favorites:",e),[]}}function S(e){try{let a=sessionStorage.getItem(b(e));if(!a)return[];return JSON.parse(a)}catch(e){return console.warn("Failed to load session favorites:",e),[]}}async function P(e,a){try{let s=S(e);if(!s.some(e=>e.id===a.id)){let r={...a,favoritedAt:new Date().toISOString()},t=[...s,r],i=t.map(e=>e.id);sessionStorage.setItem(b(e),JSON.stringify(t));try{await w.syncFavoritesToDatabase(e,i),console.log("[Favorites] Successfully added ".concat(a.id," to favorites"))}catch(r){throw console.warn("[Favorites] API sync failed for adding ".concat(a.id,", rolling back..."),r),sessionStorage.setItem(b(e),JSON.stringify(s)),r}}}catch(e){throw console.warn("Failed to add product to favorites:",e),e}}async function C(e,a){try{let s=S(e),r=s.filter(e=>e.id!==a),t=r.map(e=>e.id);sessionStorage.setItem(b(e),JSON.stringify(r));try{await w.syncFavoritesToDatabase(e,t),console.log("[Favorites] Successfully removed ".concat(a," from favorites"))}catch(r){throw console.warn("[Favorites] API sync failed for removing ".concat(a,", rolling back..."),r),sessionStorage.setItem(b(e),JSON.stringify(s)),r}}catch(e){throw console.warn("Failed to remove product from favorites:",e),e}}async function I(e,a){var s;return(s=a.id,k(e).includes(s))?(await C(e,a.id),!1):(await P(e,a),!0)}function F(e){let{results:a,isLoading:l,hasSearched:o,reportId:c}=e,n=(0,i.useRouter)(),[d,h]=(0,t.useState)("grid"),[u,p]=(0,t.useState)(!1),[v,_]=(0,t.useState)(null),{favorites:w,isFavorited:P,toggleFavorite:C}=function(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{autoClear:s=!0}=a,[r,i]=(0,t.useState)([]),[l,o]=(0,t.useState)([]),[c,n]=(0,t.useState)(!1);(0,t.useEffect)(()=>{let a=async()=>{if(c)return;let a=S(e);if(a.length>0){console.log("[Favorites] Using existing session favorites for report:",e),o(a),i(a.map(e=>e.id)),n(!0);return}try{console.log("[Favorites] Loading favorites for report:",e);let a=await N.reportsApiService.getFavorites(e);if(200===a.status){let s=a.body.map(e=>{var a;return{id:e.id,brand:e.brand||"Unknown",series:e.series,model:e.model,image:(null==(a=e.images[0])?void 0:a.url)||"",analysis:e.analysis?{color:{primary:{vector:[e.analysis.color.primary.vector[0]||0,e.analysis.color.primary.vector[1]||0],similarity:e.analysis.color.primary.similarity},secondary:{vector:[e.analysis.color.secondary.vector[0]||0,e.analysis.color.secondary.vector[1]||0],similarity:e.analysis.color.secondary.similarity}},pattern:{primary:{vector:[e.analysis.pattern.primary.vector[0]||0,e.analysis.pattern.primary.vector[1]||0],similarity:e.analysis.pattern.primary.similarity},secondary:{vector:[e.analysis.pattern.secondary.vector[0]||0,e.analysis.pattern.secondary.vector[1]||0],similarity:e.analysis.pattern.secondary.similarity}},similarity:e.analysis.similarity}:void 0,favoritedAt:new Date().toISOString()}});sessionStorage.setItem("k9.session.favorites.".concat(e),JSON.stringify(s)),o(s),i(s.map(e=>e.id)),console.log("[Favorites] Loaded",s.length,"favorites")}n(!0)}catch(e){console.error("Failed to load favorites:",e),n(!0)}};e&&!c&&a()},[e,c]),(0,t.useEffect)(()=>{let a=()=>{i(k(e)),o(S(e))};a();let s=s=>{var r;(null==(r=s.key)?void 0:r.includes("session.favorites.".concat(e)))&&a()};return window.addEventListener("storage",s),()=>window.removeEventListener("storage",s)},[e]),(0,t.useEffect)(()=>{if(s)return()=>{try{sessionStorage.removeItem(b(e)),console.log("[Favorites] Cleared session favorites for report ".concat(e))}catch(e){console.warn("Failed to clear session favorites:",e)}}},[e,s]);let d=(0,t.useCallback)(async a=>{try{let s=await I(e,a);return i(k(e)),o(S(e)),s}catch(a){return console.error("Failed to toggle favorite:",a),i(k(e)),o(S(e)),console.warn("Favorite action failed and was rolled back. Please try again."),!1}},[e]),h=(0,t.useCallback)(e=>r.includes(e),[r]);return{favorites:l,favoriteIds:r,isFavorited:h,toggleFavorite:d,isInitialized:c}}(c,{autoClear:!0}),F=e=>{let a=[];return e.brand&&a.push(e.brand),e.series&&a.push(e.series),e.model&&a.push(e.model),a.join(" ")||"Unknown Product"},M=e=>{var a;return(null==(a=e.analysis)?void 0:a.similarity)?Math.round(100*e.analysis.similarity):0},A=(0,t.useCallback)(e=>{let a="/fetch?report=".concat(c,"&product=").concat(e);n.push(a)},[c,n]),E=async()=>{if(0===w.length){console.warn("No favorites to export"),alert("Please add some products to favorites before exporting.");return}if(l){console.warn("Cannot export while searching"),alert("Please wait for the current search to complete before exporting.");return}p(!0),_({current:0,total:1,message:"Initializing export..."});try{console.log("Starting export of ".concat(w.length," favorite products..."));let{reportsApiService:e}=await Promise.resolve().then(s.bind(s,4609)),a=await e.exportFavorites(c,(e,a,s)=>{_({current:e,total:a,message:s})});if(200===a.status){_({current:1,total:1,message:"Download starting..."});let{downloadBlob:e,createExportFilename:r}=await Promise.all([s.e(496),s.e(748)]).then(s.bind(s,8748)),t=r(a.body.reportTitle);e(a.body.blob,t),console.log("Export completed successfully: ".concat(t)),_({current:1,total:1,message:"Export complete!"}),setTimeout(()=>_(null),2e3)}else throw Error(a.error||"Export failed")}catch(a){console.error("Export failed:",a);let e=a instanceof Error?a.message:"Export failed";alert("Export failed: ".concat(e,". Please try again.")),_(null)}finally{p(!1)}},R=[..."favorites"===d?w.map(e=>{let s=a.find(a=>a.id===e.id),r=(null==s?void 0:s.analysis)||e.analysis;return{id:e.id,brand:e.brand,series:e.series,model:e.model,image:e.image,analysis:r}}):a].sort((e,a)=>{let s=M(e),r=M(a);if(s!==r)return r-s;let t=F(e),i=F(a);return t.localeCompare(i)});return l?(0,r.jsxs)("div",{className:"search-results",children:[(0,r.jsxs)("div",{className:"search-filters__header",children:[(0,r.jsxs)("div",{className:"search-results__title-section",children:[(0,r.jsxs)("h3",{className:"search-filters__title",children:[(0,r.jsx)(f,{className:"w-4 h-4"}),"Results"]}),(0,r.jsx)("span",{className:"search-results__count",children:"Searching..."})]}),(0,r.jsxs)("div",{className:"search-results__header-actions",children:[(0,r.jsxs)("button",{onClick:E,disabled:!0,className:"search-results__export-btn","aria-label":"Export favorites",title:"Cannot export while searching",children:[(0,r.jsx)(x,{className:"w-4 h-4"}),"Export"]}),(0,r.jsxs)("div",{className:"search-results__view-controls",children:[(0,r.jsx)("button",{disabled:!0,className:"search-results__view-btn ".concat("grid"===d?"search-results__view-btn--active":""),"aria-label":"Grid view",children:(0,r.jsx)(y,{className:"w-4 h-4"})}),(0,r.jsx)("button",{disabled:!0,className:"search-results__view-btn ".concat("favorites"===d?"search-results__view-btn--active":""),"aria-label":"Favorites view",children:(0,r.jsx)(g,{className:"w-4 h-4"})})]})]})]}),(0,r.jsxs)("div",{className:"search-results__loading",children:[(0,r.jsx)("div",{className:"loading-spinner"}),(0,r.jsx)("p",{children:"Searching for similar products..."})]})]}):"favorites"===d&&0===R.length?(0,r.jsxs)("div",{className:"search-results",children:[(0,r.jsxs)("div",{className:"search-filters__header",children:[(0,r.jsxs)("div",{className:"search-results__title-section",children:[(0,r.jsxs)("h3",{className:"search-filters__title",children:[(0,r.jsx)(g,{className:"w-4 h-4"}),"Favorites"]}),(0,r.jsx)("span",{className:"search-results__count",children:"0 favorites"})]}),(0,r.jsxs)("div",{className:"search-results__header-actions",children:[(0,r.jsxs)("button",{onClick:E,disabled:!0,className:"search-results__export-btn","aria-label":"Export favorites",title:"No favorites to export",children:[(0,r.jsx)(x,{className:"w-4 h-4"}),"Export"]}),(0,r.jsxs)("div",{className:"search-results__view-controls",children:[(0,r.jsx)("button",{onClick:()=>h("grid"),disabled:l,className:"search-results__view-btn","aria-label":"Grid view",children:(0,r.jsx)(y,{className:"w-4 h-4"})}),(0,r.jsx)("button",{onClick:()=>h("favorites"),disabled:l,className:"search-results__view-btn search-results__view-btn--active","aria-label":"Favorites view",children:(0,r.jsx)(g,{className:"w-4 h-4"})})]})]})]}),(0,r.jsxs)("div",{className:"search-results__empty",children:[(0,r.jsx)(g,{className:"w-12 h-12 text-gray-400"}),(0,r.jsx)("h3",{children:"No favorites yet"}),(0,r.jsx)("p",{children:"Click the heart icon on any product to add it to your favorites."})]})]}):"grid"===d&&0===a.length?(0,r.jsxs)("div",{className:"search-results",children:[(0,r.jsxs)("div",{className:"search-filters__header",children:[(0,r.jsxs)("div",{className:"search-results__title-section",children:[(0,r.jsxs)("h3",{className:"search-filters__title",children:[(0,r.jsx)(f,{className:"w-4 h-4"}),"Results"]}),(0,r.jsx)("span",{className:"search-results__count",children:o?"0 products found":"No search performed"})]}),(0,r.jsxs)("div",{className:"search-results__header-actions",children:[(0,r.jsxs)("button",{onClick:E,disabled:u||l||0===w.length,className:"search-results__export-btn","aria-label":"Export favorites",title:0===w.length?"No favorites to export":l?"Cannot export while searching":u?v?"".concat(v.message," (").concat(v.current,"/").concat(v.total,")"):"Exporting...":"Export favorites as ZIP",children:[(0,r.jsx)(x,{className:"w-4 h-4"}),u?v?"".concat(Math.round(v.current/v.total*100),"%"):"Exporting...":"Export"]}),(0,r.jsxs)("div",{className:"search-results__view-controls",children:[(0,r.jsx)("button",{onClick:()=>h("grid"),disabled:l,className:"search-results__view-btn search-results__view-btn--active","aria-label":"Grid view",children:(0,r.jsx)(y,{className:"w-4 h-4"})}),(0,r.jsx)("button",{onClick:()=>h("favorites"),disabled:l,className:"search-results__view-btn","aria-label":"Favorites view",children:(0,r.jsx)(g,{className:"w-4 h-4"})})]})]})]}),(0,r.jsxs)("div",{className:"search-results__empty",children:[(0,r.jsx)(j,{className:"w-12 h-12 text-gray-400"}),o?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("h3",{children:"No products found"}),(0,r.jsx)("p",{children:"No products match your current search criteria. Try adjusting your filters and search again."})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("h3",{children:"No search performed"}),(0,r.jsx)("p",{children:'Adjust your filters in the left sidebar and click "Search Similar Products" to find matching products.'})]})]})]}):(0,r.jsxs)("div",{className:"search-results",children:[(0,r.jsxs)("div",{className:"search-filters__header",children:[(0,r.jsxs)("div",{className:"search-results__title-section",children:[(0,r.jsx)("h3",{className:"search-filters__title",children:"favorites"===d?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(g,{className:"w-4 h-4"}),"Favorites"]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(f,{className:"w-4 h-4"}),"Results"]})}),(0,r.jsxs)("span",{className:"search-results__count",children:[R.length," ","favorites"===d?1===R.length?"favorite":"favorites":1===R.length?"product found":"products found"]})]}),(0,r.jsxs)("div",{className:"search-results__header-actions",children:[(0,r.jsxs)("button",{onClick:E,disabled:u||l||0===w.length,className:"search-results__export-btn","aria-label":"Export favorites",title:0===w.length?"No favorites to export":l?"Cannot export while searching":u?v?"".concat(v.message," (").concat(v.current,"/").concat(v.total,")"):"Exporting...":"Export favorites as ZIP",children:[(0,r.jsx)(x,{className:"w-4 h-4"}),u?v?"".concat(Math.round(v.current/v.total*100),"%"):"Exporting...":"Export"]}),(0,r.jsxs)("div",{className:"search-results__view-controls",children:[(0,r.jsx)("button",{onClick:()=>h("grid"),disabled:l,className:"search-results__view-btn ".concat("grid"===d?"search-results__view-btn--active":""),"aria-label":"Grid view",children:(0,r.jsx)(y,{className:"w-4 h-4"})}),(0,r.jsx)("button",{onClick:()=>h("favorites"),disabled:l,className:"search-results__view-btn ".concat("favorites"===d?"search-results__view-btn--active":""),"aria-label":"Favorites view",children:(0,r.jsx)(g,{className:"w-4 h-4"})})]})]})]}),(0,r.jsx)("div",{className:"search-results__content",children:(0,r.jsx)("div",{className:"search-results__grid",children:R.map(e=>{var a;return(0,r.jsxs)("div",{className:"search-result-card",onClick:()=>{A(e.id)},children:[(0,r.jsxs)("div",{className:"search-result-card__image",children:[(0,r.jsx)(m.H,{src:e.image,alt:F(e),fill:!0,className:"search-result-card__img",sizes:"200px",unoptimized:!0}),(0,r.jsx)("button",{className:"search-result-card__favorite ".concat(P(e.id)?"search-result-card__favorite--active":""),onClick:a=>{a.stopPropagation(),C(e)},"aria-label":P(e.id)?"Remove from favorites":"Add to favorites",children:(0,r.jsx)(g,{className:"w-4 h-4",fill:P(e.id)?"currentColor":"none"})})]}),(0,r.jsx)("div",{className:"search-result-card__content",children:(0,r.jsxs)("div",{className:"search-result-card__info",children:[(0,r.jsxs)("div",{className:"search-result-card__similarity ".concat((a=M(e))>=90?"similarity-excellent":a>=80?"similarity-good":a>=70?"similarity-fair":a>=60?"similarity-poor":"similarity-very-poor"),children:[M(e),"%"]}),(0,r.jsx)("h3",{className:"search-result-card__title",children:(e=>{let a=[];e.brand&&a.push(e.brand),e.series&&a.push(e.series);let s=[];return a.length>0&&s.push((0,r.jsx)("div",{className:"search-result-card__name-line",children:a.map((e,s)=>(0,r.jsxs)("span",{children:[e,s<a.length-1&&(0,r.jsx)("span",{className:"search-result-card__separator",children:"›"})]},s))},"brand-series")),e.model&&s.push((0,r.jsx)("div",{className:"search-result-card__name-line",children:e.model},"model")),s.length>0?s:"Unknown Product"})(e)})]})})]},e.id)})})})]})}var M=s(7382),A=s(9099);let E=e=>"report_filters_".concat(e),R=e=>"report_results_".concat(e),D=e=>"report_searched_".concat(e);var T=s(5239);let L=(0,l.A)("external-link",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]),z=(0,l.A)("copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);var O=s(5993);function U(e){var a,s,i,l;let{product:c}=e,[n,d]=(0,t.useState)("specs"),[h,u]=(0,t.useState)({}),[m,p]=(0,t.useState)(null),v=e=>{d(e)},f=async(e,a)=>{a.preventDefault(),a.stopPropagation();try{await navigator.clipboard.writeText(e),p(e),setTimeout(()=>p(null),2e3)}catch(e){console.error("Failed to copy SKU:",e)}},_=function(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20;return e.length>a?"".concat(e.substring(0,a),"..."):e};return(0,r.jsxs)("div",{className:"search-filters",children:[(0,r.jsx)("div",{className:"search-filters__header search-filters__header--strip-top",children:(0,r.jsxs)("h3",{className:"search-filters__title",children:[(0,r.jsx)(o,{className:"w-4 h-4"}),"Product Info"]})}),(0,r.jsx)("div",{className:"search-filters__header",children:(0,r.jsxs)("div",{className:"product-info__header",children:[(0,r.jsx)("h3",{className:"product-info__brand-series",children:[c.brand,c.series].filter(Boolean).join(" • ")}),(0,r.jsx)("h2",{className:"product-info__model",children:c.model})]})}),(0,r.jsxs)("div",{className:"product-info__tabs",children:[(0,r.jsx)("button",{className:"product-info__tab ".concat("specs"===n?"product-info__tab--active":""),onClick:()=>v("specs"),children:"Specs"}),(0,r.jsx)("button",{className:"product-info__tab ".concat("buy"===n?"product-info__tab--active":""),onClick:()=>v("buy"),children:"Buy"}),(0,r.jsx)("button",{className:"product-info__tab ".concat("analysis"===n?"product-info__tab--active":""),onClick:()=>v("analysis"),children:"Analysis"})]}),(0,r.jsxs)("div",{className:"search-filters__content",children:["specs"===n&&(0,r.jsxs)("div",{className:"product-info__specs",children:[(0,r.jsx)("div",{className:"product-info__formats-header",children:(0,r.jsx)("div",{className:"product-info__section-title",children:"Product Specifications"})}),Object.entries(c.category).map(e=>{let[a,s]=e;return s&&(0,r.jsxs)("div",{className:"product-info__spec-row",children:[(0,r.jsx)("span",{className:"product-info__spec-label",children:a.charAt(0).toUpperCase()+a.slice(1)}),(0,r.jsx)("span",{className:"product-info__spec-value",children:s})]},a)})]}),"buy"===n&&(0,r.jsxs)("div",{className:"product-info__buy",children:[(0,r.jsxs)("div",{className:"product-info__formats-header",children:[(0,r.jsx)("div",{className:"product-info__section-title",children:"Available Formats"}),(0,r.jsxs)("div",{className:"product-info__size-info",children:[c.formats.length," size option",1!==c.formats.length?"s":""," available"]})]}),c.formats.map((e,a)=>{let s=h[a]||!1;return(0,r.jsxs)("div",{className:"product-info__size-option",children:[(0,r.jsxs)("div",{className:"product-info__size-header",onClick:()=>{u(e=>{let s=e[a],r={};return s||(r[a]=!0),r})},style:{cursor:"pointer"},children:[(0,r.jsxs)("div",{className:"product-info__size-label",children:[(0,r.jsx)("span",{className:"product-info__size-text",children:(()=>{let{length:a,width:s,thickness:r}=e,t=(null==a?void 0:a.val)?"".concat(a.val,'"'):"unset",i=(null==s?void 0:s.val)?"".concat(s.val,'"'):"unset",l=(null==r?void 0:r.val)?"".concat(r.val,"mm"):null;return l?"".concat(t," \xd7 ").concat(i," \xd7 ").concat(l):"".concat(t," \xd7 ").concat(i)})()}),(0,r.jsxs)("span",{className:"product-info__vendor-count",children:[e.vendors.length," vendor",1!==e.vendors.length?"s":""]})]}),(0,r.jsx)("span",{className:"product-info__size-toggle",children:s?"▲":"▼"})]}),s&&(0,r.jsx)("div",{className:"product-info__size-details",children:(0,r.jsx)("div",{className:"product-info__vendor-list",children:e.vendors.map((e,a)=>(0,r.jsxs)("div",{className:"product-info__vendor-wrapper",children:[(0,r.jsxs)("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",className:"product-info__vendor product-info__vendor--link",children:[(0,r.jsx)(L,{className:"product-info__vendor-icon"}),(0,r.jsx)("div",{className:"product-info__vendor-content",children:(0,r.jsxs)("div",{className:"product-info__vendor-main-row",children:[(0,r.jsx)("div",{className:"product-info__vendor-left-info",children:(0,r.jsx)("div",{className:"product-info__vendor-name",children:e.store})}),(0,r.jsxs)("div",{className:"product-info__vendor-right-info",children:[(0,r.jsx)("div",{className:"product-info__vendor-pricing",children:e.price?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("span",{className:"product-info__price",children:["$",e.price.val.toFixed(2)]}),(0,r.jsx)("span",{className:"product-info__price-unit",children:"/sqft"})]}):(0,r.jsx)("span",{className:"product-info__price",children:"Contact Store"})}),(0,r.jsx)("div",{className:"product-info__vendor-status-row",children:(0,r.jsx)("span",{className:"product-info__vendor-status ".concat(!0===e.discontinued?"product-info__vendor-status--out":!1===e.discontinued?"product-info__vendor-status--in-stock":"product-info__vendor-status--unknown"),children:!0===e.discontinued?"Discontinued":!1===e.discontinued?"Available":"Contact Store"})})]})]})})]}),(0,r.jsxs)("button",{type:"button",className:"product-info__vendor-sku-copy-button",onClick:a=>f(e.sku,a),title:m===e.sku?"Copied!":"Copy SKU","aria-label":"Copy SKU to clipboard",children:[(0,r.jsx)("span",{className:"product-info__vendor-sku-label",children:"SKU: "}),(0,r.jsx)("span",{className:"product-info__vendor-sku-value",title:e.sku,children:_(e.sku)}),(0,r.jsx)(z,{className:"product-info__vendor-sku-copy-icon ".concat(m===e.sku?"copied":"")})]})]},a))})})]},a)})]}),"analysis"===n&&c.analysis&&(0,r.jsxs)("div",{className:"product-info__analysis",children:[(0,r.jsx)("div",{className:"product-info__formats-header",children:(0,r.jsx)("div",{className:"product-info__section-title",children:"Performance Analysis"})}),(0,r.jsxs)("div",{className:"product-info__overall-match",children:[(0,r.jsxs)("div",{className:"product-info__match-header",children:[(0,r.jsx)("span",{className:"product-info__match-label",children:"Overall Match"}),(0,r.jsxs)("span",{className:"product-info__match-percentage",children:[Math.round(100*c.analysis.similarity),"%"]})]}),(0,r.jsx)("div",{className:"product-info__match-bar",children:(0,r.jsx)("div",{className:"product-info__match-progress",style:{width:"".concat(100*c.analysis.similarity,"%")}})}),(0,r.jsx)("div",{className:"product-info__match-description",children:c.analysis.similarity>=.8?"Excellent match - highly similar visual characteristics":c.analysis.similarity>=.6?"Good match - similar visual characteristics":c.analysis.similarity>=.4?"Fair match - some similar characteristics":"Poor match - limited visual similarity"})]}),(0,r.jsxs)("div",{className:"product-info__color-section",children:[(0,r.jsx)("div",{className:"product-info__section-title",children:"Color"}),(0,r.jsxs)("div",{className:"product-info__color-item",children:[(0,r.jsxs)("div",{className:"product-info__color-header",children:[(0,r.jsx)("span",{className:"product-info__color-label",children:"Primary"}),(0,r.jsxs)("span",{className:"product-info__color-percentage",children:[Math.round(100*(c.analysis.color.primary.similarity||0)),"%"]})]}),(0,r.jsx)("div",{className:"product-info__color-bar",children:(0,r.jsx)("div",{className:"product-info__color-progress",style:{width:"".concat(100*(c.analysis.color.primary.similarity||0),"%")}})})]}),(0,r.jsxs)("div",{className:"product-info__color-item",children:[(0,r.jsxs)("div",{className:"product-info__color-header",children:[(0,r.jsx)("span",{className:"product-info__color-label",children:"Secondary"}),(0,r.jsxs)("span",{className:"product-info__color-percentage",children:[Math.round(100*((null==(a=c.analysis.color.secondary)?void 0:a.similarity)||0)),"%"]})]}),(0,r.jsx)("div",{className:"product-info__color-bar",children:(0,r.jsx)("div",{className:"product-info__color-progress",style:{width:"".concat(100*((null==(s=c.analysis.color.secondary)?void 0:s.similarity)||0),"%")}})})]})]}),(0,r.jsxs)("div",{className:"product-info__pattern-section",children:[(0,r.jsx)("div",{className:"product-info__section-title",children:"Pattern"}),(0,r.jsxs)("div",{className:"product-info__pattern-item",children:[(0,r.jsxs)("div",{className:"product-info__pattern-header",children:[(0,r.jsx)("span",{className:"product-info__pattern-label",children:"Primary"}),(0,r.jsxs)("span",{className:"product-info__pattern-percentage",children:[Math.round(100*(c.analysis.pattern.primary.similarity||0)),"%"]})]}),(0,r.jsx)("div",{className:"product-info__pattern-bar",children:(0,r.jsx)("div",{className:"product-info__pattern-progress",style:{width:"".concat(100*(c.analysis.pattern.primary.similarity||0),"%")}})})]}),(0,r.jsxs)("div",{className:"product-info__pattern-item",children:[(0,r.jsxs)("div",{className:"product-info__pattern-header",children:[(0,r.jsx)("span",{className:"product-info__pattern-label",children:"Secondary"}),(0,r.jsxs)("span",{className:"product-info__pattern-percentage",children:[Math.round(100*((null==(i=c.analysis.pattern.secondary)?void 0:i.similarity)||0)),"%"]})]}),(0,r.jsx)("div",{className:"product-info__pattern-bar",children:(0,r.jsx)("div",{className:"product-info__pattern-progress",style:{width:"".concat(100*((null==(l=c.analysis.pattern.secondary)?void 0:l.similarity)||0),"%")}})})]})]})]})]})]})}function q(e){var a,s,i,l,o,c;let{selectedProductImages:n,referenceProductImages:h,selectedProductName:u,referenceProductName:m}=e,[p,v]=(0,t.useState)(0),[f,_]=(0,t.useState)(0),[x,y]=(0,t.useState)({}),[g,j]=(0,t.useState)(null),N=(0,t.useCallback)(e=>x[e]||{x:0,y:0,scale:1,rotation:0},[x]),b=(e,a)=>{y(s=>({...s,[e]:{...N(e),...a}}))},w=(0,t.useCallback)(e=>{let a=N(e);return 0!==a.x||0!==a.y||1!==a.scale||0!==a.rotation},[N]),k=e=>{y(a=>{let s={...a};return delete s[e],s})},S=(e,a)=>{e.preventDefault();let s=e.currentTarget.getBoundingClientRect(),r=s.left+s.width/2,t=s.top+s.height/2,i=Math.atan2(e.clientY-t,e.clientX-r)*(180/Math.PI);j({type:0===e.button?"pan":2===e.button?"rotate":null,startX:e.clientX,startY:e.clientY,imageId:a,initialTransform:N(a),imageCenterX:r,imageCenterY:t,initialAngle:i})},P=e=>{if(!g)return;let a=e.clientX-g.startX,s=e.clientY-g.startY;if("pan"===g.type)b(g.imageId,{x:g.initialTransform.x+a,y:g.initialTransform.y+s});else if("rotate"===g.type){let a=Math.atan2(e.clientY-g.imageCenterY,e.clientX-g.imageCenterX)*(180/Math.PI)-g.initialAngle;b(g.imageId,{rotation:g.initialTransform.rotation+a})}},C=()=>{j(null)},I=(e,a)=>{e.preventDefault();let s=e.deltaY>0?.9:1.1,r=Math.max(.1,Math.min(5,N(a).scale*s));b(a,{scale:r})},F=e=>{e.preventDefault()},M=e=>{let a=N(e);return{transform:"translate(".concat(a.x,"px, ").concat(a.y,"px) scale(").concat(a.scale,") rotate(").concat(a.rotation,"deg)"),transformOrigin:"center center",transition:(null==g?void 0:g.imageId)===e?"none":"transform 0.1s ease-out"}};return(0,t.useEffect)(()=>{if(g){let e=e=>{let a=e.clientX-g.startX,s=e.clientY-g.startY;if("pan"===g.type)y(e=>({...e,[g.imageId]:{...N(g.imageId),x:g.initialTransform.x+a,y:g.initialTransform.y+s}}));else if("rotate"===g.type){let a=Math.atan2(e.clientY-g.imageCenterY,e.clientX-g.imageCenterX)*(180/Math.PI)-g.initialAngle;y(e=>({...e,[g.imageId]:{...N(g.imageId),rotation:g.initialTransform.rotation+a}}))}},a=()=>{j(null)};return document.addEventListener("mousemove",e),document.addEventListener("mouseup",a),()=>{document.removeEventListener("mousemove",e),document.removeEventListener("mouseup",a)}}},[g,N]),(0,r.jsx)("div",{className:"h-full flex flex-col",children:(0,r.jsxs)("div",{className:"flex-1 grid grid-cols-2 min-h-0",children:[(0,r.jsxs)("div",{className:"product-comparison__column",children:[(0,r.jsx)("div",{className:"search-filters__header product-comparison__image-header flex-shrink-0",children:(0,r.jsxs)("h3",{className:"search-filters__title",children:[(0,r.jsx)(d,{className:"w-4 h-4"}),"Product Images"]})}),(0,r.jsxs)("div",{className:"flex-1 flex flex-col min-h-0",children:[(0,r.jsxs)("div",{className:"product-comparison__image-container flex-1 flex items-center justify-center min-h-0",onMouseDown:e=>{var a;return S(e,(null==(a=n[p])?void 0:a.id)||"sel-default")},onMouseMove:P,onMouseUp:C,onWheel:e=>{var a;return I(e,(null==(a=n[p])?void 0:a.id)||"sel-default")},onContextMenu:F,style:{cursor:(null==g?void 0:g.type)==="pan"?"grabbing":(null==g?void 0:g.type)==="rotate"?"crosshair":"grab"},children:[(0,r.jsx)("div",{className:"product-comparison__controls-hint",children:"Drag: Pan • Right+Drag: Rotate • Scroll: Zoom"}),(0,r.jsx)("button",{className:"product-comparison__reset-button",onClick:e=>{var a;e.stopPropagation(),k((null==(a=n[p])?void 0:a.id)||"sel-default")},"aria-label":"Reset image transformations",style:{display:w((null==(a=n[p])?void 0:a.id)||"sel-default")?"flex":"none"},children:(0,r.jsx)(O.A,{className:"w-4 h-4"})}),n.length>0?(0,r.jsx)(T.default,{src:(null==(s=n[p])?void 0:s.url)||n[0].url,alt:u,width:0,height:0,className:"pointer-events-none",style:{width:"auto",height:"auto",maxWidth:"400px",maxHeight:"400px",objectFit:"contain",...M((null==(i=n[p])?void 0:i.id)||"sel-default")},unoptimized:!0}):(0,r.jsx)("span",{className:"text-gray-500",children:"No image available"})]}),n.length>0&&(0,r.jsx)("div",{className:"product-comparison__thumbnails flex-shrink-0",children:n.map((e,a)=>(0,r.jsx)("button",{onClick:()=>v(a),className:"product-comparison__thumbnail ".concat(a===p?"product-comparison__thumbnail--active":""),children:(0,r.jsx)(T.default,{src:e.url,alt:"".concat(u," ").concat(a+1),width:64,height:64,className:"product-comparison__thumbnail-image",unoptimized:!0})},e.id))})]})]}),(0,r.jsxs)("div",{className:"product-comparison__column",children:[(0,r.jsx)("div",{className:"search-filters__header product-comparison__image-header flex-shrink-0",children:(0,r.jsxs)("h3",{className:"search-filters__title",children:[(0,r.jsx)(d,{className:"w-4 h-4"}),"Reference Images"]})}),(0,r.jsxs)("div",{className:"flex-1 flex flex-col min-h-0",children:[(0,r.jsxs)("div",{className:"product-comparison__image-container flex-1 flex items-center justify-center min-h-0",onMouseDown:e=>{var a;return S(e,(null==(a=h[f])?void 0:a.id)||"ref-default")},onMouseMove:P,onMouseUp:C,onWheel:e=>{var a;return I(e,(null==(a=h[f])?void 0:a.id)||"ref-default")},onContextMenu:F,style:{cursor:(null==g?void 0:g.type)==="pan"?"grabbing":(null==g?void 0:g.type)==="rotate"?"crosshair":"grab"},children:[(0,r.jsx)("div",{className:"product-comparison__controls-hint",children:"Drag: Pan • Right+Drag: Rotate • Scroll: Zoom"}),(0,r.jsx)("button",{className:"product-comparison__reset-button",onClick:e=>{var a;e.stopPropagation(),k((null==(a=h[f])?void 0:a.id)||"ref-default")},"aria-label":"Reset image transformations",style:{display:w((null==(l=h[f])?void 0:l.id)||"ref-default")?"flex":"none"},children:(0,r.jsx)(O.A,{className:"w-4 h-4"})}),h.length>0?(0,r.jsx)(T.default,{src:(null==(o=h[f])?void 0:o.url)||h[0].url,alt:m,width:0,height:0,className:"pointer-events-none",style:{width:"auto",height:"auto",maxWidth:"400px",maxHeight:"400px",objectFit:"contain",...M((null==(c=h[f])?void 0:c.id)||"ref-default")},unoptimized:!0}):(0,r.jsx)("span",{className:"text-gray-500",children:"No image available"})]}),h.length>0&&(0,r.jsx)("div",{className:"product-comparison__thumbnails flex-shrink-0",children:h.map((e,a)=>(0,r.jsx)("button",{onClick:()=>_(a),className:"product-comparison__thumbnail ".concat(a===f?"product-comparison__thumbnail--active":""),children:(0,r.jsx)(T.default,{src:e.url,alt:"".concat(m," ").concat(a+1),width:64,height:64,className:"product-comparison__thumbnail-image",unoptimized:!0})},e.id))})]})]})]})})}function J(e){let{reportId:a,productId:i}=e,[l,o]=(0,t.useState)({selectedProduct:null,referenceReport:null,loading:!0,error:null}),c=(0,t.useRef)(!1);return((0,t.useEffect)(()=>{(async()=>{if(!c.current){c.current=!0;try{let e;o(e=>({...e,loading:!0,error:null}));let{reportsApi:r}=await Promise.resolve().then(s.bind(s,7382)),t=await r.getFullReport(a,"ProductComparisonContainer");if(!t)throw Error("Report ".concat(a," not found"));{let{ReportsApiService:r}=await Promise.resolve().then(s.bind(s,4609)),t=await r.getProduct(a,i);if(200===t.status)e=t.body;else throw Error(t.error||"Product ".concat(i," not found"))}o({selectedProduct:e,referenceReport:t,loading:!1,error:null})}catch(e){o(a=>({...a,loading:!1,error:e instanceof Error?e.message:"An error occurred"}))}finally{c.current=!1}}})()},[i,a]),l.loading)?(0,r.jsxs)("div",{className:"report-create",children:[(0,r.jsx)("aside",{className:"report-create__sidebar",children:(0,r.jsx)("div",{className:"report-create__form",children:(0,r.jsx)("div",{className:"report-form",children:(0,r.jsx)("div",{className:"report-form__body",children:(0,r.jsxs)("div",{className:"report-page__loading",children:[(0,r.jsx)("div",{className:"loading-spinner"}),(0,r.jsx)("p",{children:"Loading product comparison..."})]})})})})}),(0,r.jsx)("div",{style:{flex:1,background:"var(--background)"}})]}):!l.error&&l.selectedProduct&&l.referenceReport?(0,r.jsxs)("div",{className:"report-create",children:[(0,r.jsx)("aside",{className:"report-create__sidebar",children:(0,r.jsx)("div",{className:"report-create__form",children:(0,r.jsx)("div",{className:"report-form",children:(0,r.jsx)("div",{className:"report-form__body",children:(0,r.jsx)(U,{product:l.selectedProduct})})})})}),(0,r.jsxs)("main",{style:{flex:1,overflow:"hidden",display:"flex",flexDirection:"column"},children:[(0,r.jsx)(n,{report:l.referenceReport}),(0,r.jsx)(q,{selectedProductImages:l.selectedProduct.images,referenceProductImages:l.referenceReport.reference.images,selectedProductName:"".concat(l.selectedProduct.brand," ").concat(l.selectedProduct.model),referenceProductName:"".concat(l.referenceReport.reference.brand," ").concat(l.referenceReport.reference.model)})]})]}):(0,r.jsxs)("div",{className:"report-create",children:[(0,r.jsx)("aside",{className:"report-create__sidebar",children:(0,r.jsx)("div",{className:"report-create__form",children:(0,r.jsx)("div",{className:"report-form",children:(0,r.jsx)("div",{className:"report-form__body",children:(0,r.jsx)("div",{className:"report-page__error",children:(0,r.jsx)("p",{children:l.error||"Product not found"})})})})})}),(0,r.jsx)("div",{style:{flex:1,background:"var(--background)"}})]})}function Y(e){let{reportId:a}=e,l=(0,i.useSearchParams)(),o=l.get("report"),c=l.get("product"),d=o||a,{report:h,isLoading:u,error:m,searchResults:v,isSearching:f,hasSearched:x,handleSearch:y,initialFavorites:g,searchFilters:j,setSearchFilters:N}=function(e){var a;let{reportId:r}=e,[i,l]=(0,t.useState)(null),[o,c]=(0,t.useState)(!0),[n,d]=(0,t.useState)(null),[h,u]=(0,t.useState)([]),[m,p]=(0,t.useState)(!1),[v,f]=(0,t.useState)(!1),[_,x]=(0,t.useState)(null),y=(0,t.useRef)(!1);console.log("[useReportData] Hook instantiated for reportId: ".concat(r),null==(a=Error().stack)?void 0:a.split("\n")[2]),(0,t.useEffect)(()=>{if(r)try{let e=sessionStorage.getItem(E(r));e&&x(JSON.parse(e));let a=sessionStorage.getItem(R(r));a&&u(JSON.parse(a));let s=sessionStorage.getItem(D(r));s&&f(JSON.parse(s))}catch(e){console.warn("Failed to load persisted search data:",e)}},[r]),(0,t.useEffect)(()=>{r&&_&&sessionStorage.setItem(E(r),JSON.stringify(_))},[_,r]),(0,t.useEffect)(()=>{r&&sessionStorage.setItem(R(r),JSON.stringify(h))},[h,r]),(0,t.useEffect)(()=>{r&&sessionStorage.setItem(D(r),JSON.stringify(v))},[v,r]),(0,t.useEffect)(()=>{(async()=>{if(!y.current&&r)try{y.current=!0,c(!0),d(null),console.log("[useReportData] Loading report: ".concat(r));let e=await M.reportsApi.getFullReport(r,"useReportData");if(!e)return void d("Report not found");l(e),console.log("[useReportData] Successfully loaded report: ".concat(r))}catch(e){d(e instanceof Error?e.message:"Failed to load report")}finally{c(!1),y.current=!1}})()},[r]);let g=async e=>{p(!0),f(!0),x(e);try{if(!i)return void console.warn("No report loaded, cannot search");try{var a,r,t,l,o,c;console.log("[API] Starting search for reportId:",i.id),console.log("[API] Search filters:",e);let{reportsApiService:n}=await Promise.resolve().then(s.bind(s,4609)),d={category:{type:null==(a=e.categories.type)?void 0:a[0],material:null==(r=e.categories.material)?void 0:r[0],look:null==(t=e.categories.look)?void 0:t[0],texture:null==(l=e.categories.texture)?void 0:l[0],finish:null==(o=e.categories.finish)?void 0:o[0],edge:null==(c=e.categories.edge)?void 0:c[0]},similarity:{threshold:e.colorPrimarySimilarity?(100-e.colorPrimarySimilarity)/100:void 0,colorSecondary:e.colorSecondarySimilarity?(100-e.colorSecondarySimilarity)/100:void 0,patternPrimary:e.patternPrimarySimilarity?(100-e.patternPrimarySimilarity)/100:void 0,patternSecondary:e.patternSecondarySimilarity?(100-e.patternSecondarySimilarity)/100:void 0},shape:{length:e.maxLengthDiff,width:e.maxWidthDiff,thickness:e.maxThicknessDiff}};console.log("[API] Transformed API filters:",d);let h=await n.searchProducts(i.id,{filters:d,page:1,limit:50});if(console.log("[API] Search response status:",h.status),console.log("[API] Search response:",h),200===h.status){console.log("[API] Search successful, found",h.body.products.length,"products"),u(h.body.products);return}throw console.error("Search failed:",h.error),Error(h.error||"Search failed")}catch(e){console.error("[API] Error during search:",e),console.log("[API] Falling back to mock implementation")}await (0,A.e)(1e3);let{getMockSearchResults:n}=await Promise.resolve().then(s.bind(s,9099)),d=n(i.id,i.reference.id),h=d.length,m=Math.floor(Math.random()*(h+1)),p=[...d].sort(()=>Math.random()-.5).slice(0,m);u(p)}catch(e){console.error("Search failed:",e)}finally{p(!1)}};return{report:i,isLoading:o,error:n,searchResults:h,isSearching:m,hasSearched:v,handleSearch:g,initialFavorites:(null==i?void 0:i.favorites)||[],searchFilters:_,setSearchFilters:e=>{x(e)}}}({reportId:d});return c&&h?(0,r.jsx)(J,{reportId:d,productId:c}):u?(0,r.jsxs)("div",{className:"report-create",children:[(0,r.jsx)("aside",{className:"report-create__sidebar",children:(0,r.jsx)("div",{className:"report-create__form",children:(0,r.jsx)("div",{className:"report-form",children:(0,r.jsx)("div",{className:"report-form__body",children:(0,r.jsxs)("div",{className:"report-page__loading",children:[(0,r.jsx)("div",{className:"loading-spinner"}),(0,r.jsx)("p",{children:"Loading report..."})]})})})})}),(0,r.jsx)("div",{style:{flex:1,background:"var(--background)"}})]}):m||!h?(0,r.jsxs)("div",{className:"report-create",children:[(0,r.jsx)("aside",{className:"report-create__sidebar",children:(0,r.jsx)("div",{className:"report-create__form",children:(0,r.jsx)("div",{className:"report-form",children:(0,r.jsx)("div",{className:"report-form__body",children:(0,r.jsx)("div",{className:"report-page__error",children:(0,r.jsx)("p",{children:m||"Report not found"})})})})})}),(0,r.jsx)("div",{style:{flex:1,background:"var(--background)"}})]}):(0,r.jsxs)("div",{className:"report-create",children:[(0,r.jsx)("aside",{className:"report-create__sidebar",children:(0,r.jsx)("div",{className:"report-create__form",children:(0,r.jsxs)("div",{className:"report-form",children:[(0,r.jsx)(p,{images:h.reference.images}),(0,r.jsx)("div",{className:"report-form__body",children:(0,r.jsx)(_,{referenceProduct:h.reference,onSearch:y,isSearching:f,filters:j,onFiltersChange:N})})]})})}),(0,r.jsxs)("main",{style:{flex:1,overflow:"hidden",display:"flex",flexDirection:"column"},children:[(0,r.jsx)(n,{report:h}),(0,r.jsx)(F,{results:v,isLoading:f,hasSearched:x,reportId:d,referenceProduct:h.reference,initialFavorites:g})]})]})}function H(){let e=(0,i.useSearchParams)().get("report");return e?(0,r.jsx)(Y,{reportId:e}):(0,r.jsxs)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"50vh",flexDirection:"column",gap:"1rem"},children:[(0,r.jsx)("h2",{children:"Search ID Required"}),(0,r.jsx)("p",{children:"Please provide a search ID in the URL: /fetch?report=YOUR_SEARCH_ID"})]})}function X(){return(0,r.jsx)(t.Suspense,{fallback:(0,r.jsx)("div",{children:"Loading..."}),children:(0,r.jsx)(H,{})})}s(2252)},2252:()=>{},5574:(e,a,s)=>{Promise.resolve().then(s.bind(s,918))},5993:(e,a,s)=>{"use strict";s.d(a,{A:()=>r});let r=(0,s(1847).A)("house",[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-6a2 2 0 0 1 2.582 0l7 6A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"r6nss1"}]])},6547:(e,a,s)=>{"use strict";s.d(a,{H:()=>l});var r=s(5155),t=s(5239),i=s(2115);function l(e){let{src:a,alt:s,fill:l,width:o,height:c,className:n="",sizes:d,unoptimized:h=!0,priority:u=!1}=e,[m,p]=(0,i.useState)(!0),[v,f]=(0,i.useState)(!1),_=!a||v;return(0,r.jsxs)(r.Fragment,{children:[m&&!_&&(0,r.jsx)("div",{className:"image-loading-overlay",style:{position:"absolute",inset:0,background:"var(--control-background, #1e293b)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:2,borderRadius:"inherit"},children:(0,r.jsx)("div",{className:"loading-spinner"})}),(0,r.jsx)(t.default,{src:_?"/placeholder.svg":a,alt:s,fill:l,width:l?void 0:o,height:l?void 0:c,className:n,sizes:d,unoptimized:h,priority:u,onLoad:()=>{p(!1)},onError:()=>{p(!1),f(!0)},style:{opacity:m&&!_?0:1,transition:"opacity 0.2s ease-in-out"}})]})}},9099:(e,a,s)=>{"use strict";s.d(a,{e:()=>i,getMockSearchResults:()=>t});var r=s(8198);function t(e,a){return(0,r.bd)(e,a,20)}t("1","p1");let i=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3;return new Promise(a=>setTimeout(a,e))}}},e=>{e.O(0,[359,780,382,441,255,358],()=>e(e.s=5574)),_N_E=e.O()}]);