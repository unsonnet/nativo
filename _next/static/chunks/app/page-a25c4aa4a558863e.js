(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{63:(e,t,s)=>{"use strict";var n=s(7260);s.o(n,"usePathname")&&s.d(t,{usePathname:function(){return n.usePathname}}),s.o(n,"useRouter")&&s.d(t,{useRouter:function(){return n.useRouter}}),s.o(n,"useSearchParams")&&s.d(t,{useSearchParams:function(){return n.useSearchParams}})},87:(e,t,s)=>{"use strict";s.d(t,{iD:()=>o,Ow:()=>l,ns:()=>u});var n=s(3280),r=function(e){return e.SUCCESS="SUCCESS",e.RESET="RESET",e.DENIED="DENIED",e}({});let i="".concat("https://824xuvy567.execute-api.us-east-2.amazonaws.com/securek9","/auth");function a(e,t,s){return{status:e,body:t,error:s}}async function o(e,t){try{var s,o;let l=await fetch("".concat(i,"/login"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:e,password:t})}),u=null!=(s=await l.json())?s:{};if(200===l.status&&u.accessToken&&u.idToken){let t={idToken:u.idToken,accessToken:u.accessToken,refreshToken:u.refreshToken,username:e};return n.LP.set(t),a(200,r.SUCCESS)}if(202===l.status&&u.session&&u.username)return n.LP.setResetSession(u.username,u.session),a(202,r.RESET);return a(l.status,r.DENIED,null!=(o=null==u?void 0:u.message)?o:"")}catch(t){let e=t&&"object"==typeof t&&"message"in t&&"string"==typeof t.message?t.message:String(t);return a(500,r.DENIED,e)}}async function l(){let e=n.LP.refreshToken,t=n.LP.username;if(!e||!t)return a(401,!1,"Missing refresh token or username");try{var s;let r=await fetch("".concat(i,"/refresh"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refreshToken:e,username:t})}),o=null!=(s=await r.json())?s:{};if(200===r.status&&o.accessToken&&o.idToken)return n.LP.set({idToken:o.idToken,accessToken:o.accessToken,refreshToken:e,username:t}),a(200,!0);return(401===r.status||403===r.status)&&n.LP.clear(),a(r.status,!1,(null==o?void 0:o.message)||"Token refresh failed")}catch(e){return a(500,!1,e&&"object"==typeof e&&"message"in e&&"string"==typeof e.message?e.message:String(e))}}async function u(e){let t=n.LP.idToken;if(t&&!n.LP.expired){let s=await e({Authorization:"Bearer ".concat(t)});if(401===s.status){if((await l()).body){let t=n.LP.idToken;if(t)return e({Authorization:"Bearer ".concat(t)})}n.LP.clear()}return s}let s=await l();if(!s.body)return n.LP.clear(),{status:s.status,body:null,error:s.error||"Authentication failed"};let r=n.LP.idToken;return e(r?{Authorization:"Bearer ".concat(r)}:{})}},854:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});var n=s(4582);function r(){return(0,n.Z)()}},3280:(e,t,s)=>{"use strict";s.d(t,{LP:()=>o,xI:()=>i});let n="k9:auth:tokens",r="k9:auth:reset";function i(e){try{let t=e.split(".");if(t.length<2)return null;let s=t[1],n=atob(s.replace(/-/g,"+").replace(/_/g,"/"));return JSON.parse(decodeURIComponent(escape(n)))}catch(e){return null}}class a{set(e){this.isClient&&(localStorage.setItem(n,JSON.stringify(e)),localStorage.removeItem(r))}setResetSession(e,t){this.isClient&&(localStorage.setItem(r,JSON.stringify({username:e,session:t})),localStorage.removeItem(n))}clear(){this.isClient&&(localStorage.removeItem(n),localStorage.removeItem(r))}clearResetSession(){this.isClient&&localStorage.removeItem(r)}get all(){if(!this.isClient)return null;let e=localStorage.getItem(n);return e?JSON.parse(e):null}get accessToken(){var e,t;return null!=(t=null==(e=this.all)?void 0:e.accessToken)?t:null}get idToken(){var e,t;return null!=(t=null==(e=this.all)?void 0:e.idToken)?t:null}get refreshToken(){var e,t;return null!=(t=null==(e=this.all)?void 0:e.refreshToken)?t:null}get username(){var e,t;return null!=(t=null==(e=this.all)?void 0:e.username)?t:null}get resetSession(){if(!this.isClient)return null;let e=localStorage.getItem(r);if(!e)return null;try{return JSON.parse(e).session}catch(e){return null}}get resetUsername(){if(!this.isClient)return null;let e=localStorage.getItem(r);if(!e)return null;try{return JSON.parse(e).username}catch(e){return null}}get expired(){let e=this.accessToken;if(!e)return!0;let t=i(e);if(!t||!t.exp)return!0;let s=Math.floor(Date.now()/1e3);return t.exp<=s}get invalid(){return!this.idToken||!this.accessToken||!!this.expired&&!this.refreshToken}constructor(){this.isClient=!0}}let o=new a},3540:(e,t,s)=>{"use strict";s.d(t,{i:()=>o});var n=s(3280),r=s(87);let i=["mousedown","mousemove","keypress","scroll","touchstart","click"];class a{initialize(e,t){this.isClient&&!this.isInitialized&&(this.onSessionExpired=e||null,this.onRefreshError=t||null,this.isInitialized=!0,this.setupActivityTracking(),this.startRefreshTimer(),console.log("SessionManager initialized"))}cleanup(){this.isClient&&(i.forEach(e=>{document.removeEventListener(e,this.updateActivity,!0)}),this.refreshTimer&&(clearInterval(this.refreshTimer),this.refreshTimer=null),this.isInitialized=!1,console.log("SessionManager cleaned up"))}setupActivityTracking(){this.isClient&&i.forEach(e=>{document.addEventListener(e,this.updateActivity,!0)})}isInactive(){return Date.now()-this.lastActivityTime>18e5}needsRefresh(){let e=n.LP.accessToken;if(!e)return!1;try{let t=JSON.parse(atob(e.split(".")[1]));return 1e3*t.exp-Date.now()<6e5}catch(e){return!1}}startRefreshTimer(){this.isClient&&(this.refreshTimer=setInterval(async()=>{await this.checkAndRefreshSession()},3e5))}async checkAndRefreshSession(){try{if(!n.LP.accessToken||!n.LP.refreshToken)return;if(this.isInactive()){console.log("User inactive for too long, ending session"),this.endSession();return}if(n.LP.expired||this.needsRefresh()){if(console.log("Token needs refresh, attempting refresh..."),!(await (0,r.Ow)()).body){console.log("Token refresh failed"),this.handleRefreshError();return}console.log("Token refreshed successfully")}}catch(e){console.error("Error during session check:",e),this.handleRefreshError()}}handleRefreshError(){this.onRefreshError?this.onRefreshError():this.endSession()}endSession(){n.LP.clear(),this.onSessionExpired&&this.onSessionExpired()}async manualRefresh(){try{if(!n.LP.refreshToken)return!1;return!!(await (0,r.Ow)()).body}catch(e){return console.error("Manual refresh failed:",e),!1}}resetActivity(){this.lastActivityTime=Date.now()}getTimeUntilInactive(){return Math.max(0,18e5-(Date.now()-this.lastActivityTime))}isSessionActive(){return!this.isInactive()&&!n.LP.expired&&!!n.LP.accessToken}constructor(){this.lastActivityTime=Date.now(),this.refreshTimer=null,this.onSessionExpired=null,this.onRefreshError=null,this.isInitialized=!1,this.isClient=!0,this.updateActivity=()=>{this.lastActivityTime=Date.now()}}}let o=new a},4582:(e,t,s)=>{"use strict";s.d(t,{AuthProvider:()=>d,Z:()=>h});var n=s(5155),r=s(2115),i=s(63),a=s(3280),o=s(87),l=s(3540);let u=(0,r.createContext)(void 0),c={id:"demo-user-1",name:"Demo User",email:"demo@k9search.com",avatarUrl:void 0};function d(e){let{children:t}=e,[s,d]=(0,r.useState)({user:null,loading:!0}),[h,g]=(0,r.useState)(!1),m=(0,i.useRouter)();(0,r.useEffect)(()=>{g(!0)},[]);let f=(0,r.useCallback)(()=>{console.log("Session expired, redirecting to login"),d({user:null,loading:!1}),m.push("/")},[m]),p=(0,r.useCallback)(()=>{console.log("Token refresh failed, redirecting to login"),d({user:null,loading:!1}),m.push("/")},[m]);async function v(e,t){let s=await (0,o.iD)(e,t);if(200===s.status){let t=a.LP.idToken,o=t?(0,a.xI)(t):null;if(o){var n,r,i;d({user:{id:String(null!=(n=o.sub)?n:""),name:String(null!=(i=null!=(r=o.name)?r:o["cognito:username"])?i:e),email:"string"==typeof o.email?o.email:void 0},loading:!1})}else d({user:null,loading:!1});return{ok:!0,status:s.status}}return{ok:!1,status:s.status}}return(0,r.useEffect)(()=>{let e=!1;return async function(){if(h)try{var t,s,n,r,i,l;let u=a.LP.all;if(u&&!a.LP.expired){let r=(0,a.xI)(u.idToken);if(r&&!e)return void d({user:{id:String(null!=(t=r.sub)?t:""),name:String(null!=(n=null!=(s=r.name)?s:r["cognito:username"])?n:""),email:"string"==typeof r.email?r.email:void 0},loading:!1})}if(a.LP.refreshToken)try{let t=(0,o.Ow)(),s=new Promise((e,t)=>setTimeout(()=>t(Error("Refresh timeout")),5e3)),n=await Promise.race([t,s]);if(n&&"object"==typeof n&&"body"in n&&n.body&&a.LP.idToken){let t=(0,a.xI)(a.LP.idToken);if(t&&!e)return void d({user:{id:String(null!=(r=t.sub)?r:""),name:String(null!=(l=null!=(i=t.name)?i:t["cognito:username"])?l:""),email:"string"==typeof t.email?t.email:void 0},loading:!1})}}catch(e){console.log("Refresh failed or timed out:",e)}e||d({user:null,loading:!1})}catch(t){console.error("Auth initialization error:",t),e||d({user:null,loading:!1})}}(),()=>{e=!0}},[h]),(0,r.useEffect)(()=>{if(h)return s.user&&!s.loading?l.i.initialize(f,p):l.i.cleanup(),()=>{l.i.cleanup()}},[s.user,s.loading,h,f,p]),(0,n.jsx)(u.Provider,{value:{user:s.user,loading:s.loading,signInWithDummy:function(){d({user:c,loading:!1})},signIn:v,signOut:function(){a.LP.clear(),l.i.cleanup(),d({user:null,loading:!1}),m.push("/")}},children:t})}function h(){let e=(0,r.useContext)(u);if(!e)throw Error("useAuthContext must be used within an AuthProvider");return e}},9353:(e,t,s)=>{Promise.resolve().then(s.bind(s,9547))},9547:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>o});var n=s(5155),r=s(854),i=s(63),a=s(2115);function o(){let{user:e,signInWithDummy:t,signIn:s}=(0,r.A)(),o=(0,i.useRouter)(),[l,u]=(0,a.useState)(!1),[c,d]=(0,a.useState)({username:"",password:""}),[h,g]=(0,a.useState)(!1),[m,f]=(0,a.useState)(""),[p,v]=(0,a.useState)(!1);(0,a.useEffect)(()=>{v(!0)},[]),(0,a.useEffect)(()=>{p&&e&&o.push("/dashboard")},[e,o,p]);let k=async e=>{e.preventDefault(),g(!0),f("");try{"Demo"===c.username&&"Password"===c.password?t():(await s(c.username,c.password)).ok||f("Invalid username or password. Try Demo/Password for demo access.")}catch(e){f("Login failed. Please try again.")}finally{g(!1)}};return p?e?null:(0,n.jsx)("div",{className:"landing-page ".concat(l?"landing-page--with-form":""),children:(0,n.jsxs)("div",{className:"landing-page__container ".concat(l?"landing-page__container--login":""),children:[(0,n.jsxs)("div",{className:"landing-page__logo",children:[(0,n.jsxs)("svg",{width:"64",height:"64",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,n.jsx)("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",stroke:"currentColor",strokeWidth:"2"}),(0,n.jsx)("path",{d:"M9 9h6v6H9z",fill:"currentColor"})]}),(0,n.jsx)("h1",{className:"landing-page__company-name",children:"K9 Search"})]}),(0,n.jsxs)("div",{className:"landing-page__content",children:[(0,n.jsxs)("div",{className:"landing-page__welcome",children:[(0,n.jsx)("p",{className:"landing-page__description",children:"Like, kind, and quality flooring discovery using photo recognition technology."}),(0,n.jsx)("button",{onClick:()=>u(!0),className:"landing-page__login-button",children:"Get Started"})]}),(0,n.jsx)("div",{className:"landing-page__login-form",children:(0,n.jsxs)("form",{onSubmit:k,className:"login-form",children:[(0,n.jsxs)("div",{className:"login-form__field",children:[(0,n.jsx)("label",{htmlFor:"username",className:"login-form__label",children:"Username"}),(0,n.jsx)("input",{id:"username",type:"text",value:c.username,onChange:e=>d(t=>({...t,username:e.target.value})),className:"login-form__input",placeholder:"Enter your username",required:!0})]}),(0,n.jsxs)("div",{className:"login-form__field",children:[(0,n.jsx)("label",{htmlFor:"password",className:"login-form__label",children:"Password"}),(0,n.jsx)("input",{id:"password",type:"password",value:c.password,onChange:e=>d(t=>({...t,password:e.target.value})),className:"login-form__input",placeholder:"Enter your password",required:!0})]}),m&&(0,n.jsx)("div",{className:"login-form__error",children:m}),(0,n.jsxs)("div",{className:"login-form__actions",children:[(0,n.jsx)("button",{type:"button",onClick:()=>u(!1),className:"login-form__button login-form__button--secondary",children:"Back"}),(0,n.jsx)("button",{type:"submit",disabled:h,className:"login-form__button login-form__button--primary",children:h?"Signing In...":"Sign In"})]})]})})]})]})}):(0,n.jsx)("div",{className:"landing-page",children:(0,n.jsxs)("div",{className:"landing-page__container",children:[(0,n.jsx)("div",{className:"landing-page__logo",children:(0,n.jsxs)("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,n.jsx)("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",stroke:"currentColor",strokeWidth:"2"}),(0,n.jsx)("path",{d:"M9 9h6v6H9z",fill:"currentColor"})]})}),(0,n.jsx)("div",{className:"landing-page__loading",children:"Loading..."})]})})}}},e=>{e.O(0,[441,255,358],()=>e(e.s=9353)),_N_E=e.O()}]);