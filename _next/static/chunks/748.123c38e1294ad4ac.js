"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[748],{8748:(e,t,o)=>{o.d(t,{createExportFilename:()=>g,downloadBlob:()=>s,exportFavoritesAsZip:()=>d});var n=o(7496),r=o.n(n);async function a(e){try{let t=await fetch(e,{mode:"cors",headers:{Accept:"image/*,*/*;q=0.8"}});if(!t.ok)throw Error("Failed to fetch image: ".concat(t.statusText));return await t.blob()}catch(t){try{console.warn("CORS failed, trying no-cors mode for image:",e);let t=await fetch(e,{mode:"no-cors",headers:{Accept:"image/*,*/*;q=0.8"}});return await t.blob()}catch(t){throw console.error("Failed to download image with both CORS and no-cors:",t),Error("Could not download image from ".concat(e,": ").concat(t instanceof Error?t.message:"Unknown error"))}}}async function i(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:800,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:600;return new Promise((n,r)=>{let a=new Image,i=document.createElement("canvas"),c=i.getContext("2d");if(!c)return void r(Error("Could not get canvas context"));a.onerror=()=>{r(Error("Failed to load image"))};let l=URL.createObjectURL(e);a.onload=()=>{URL.revokeObjectURL(l),(()=>{let{width:e,height:l}=a,{width:d,height:s}=a;if(e>t||l>o){let n=Math.min(t/e,o/l);d=Math.round(e*n),s=Math.round(l*n)}i.width=d,i.height=s,c.drawImage(a,0,0,d,s),i.toBlob(e=>{e?n(e):r(Error("Failed to create blob from canvas"))},"image/jpeg",.8)})()},a.src=l})}function c(e,t,o){let n={row_index:t,type:o,brand:e.brand||"",series:e.series||"",model:e.model||"",category_type:e.category.type||"",category_material:e.category.material||"",category_look:e.category.look||"",category_texture:e.category.texture||"",category_finish:e.category.finish||"",category_edge:e.category.edge||""},r=[];return 0===e.formats.length?r.push({...n,format_length_val:"",format_length_unit:"",format_width_val:"",format_width_unit:"",format_thickness_val:"",format_thickness_unit:"",vendor_sku:"",vendor_store:"",vendor_name:"",vendor_price_val:"",vendor_price_unit:"",vendor_discontinued:"",vendor_url:""}):e.formats.forEach(e=>{var t,o,a,i,c,l;let d={format_length_val:(null==(t=e.length)?void 0:t.val)||"",format_length_unit:(null==(o=e.length)?void 0:o.unit)||"",format_width_val:(null==(a=e.width)?void 0:a.val)||"",format_width_unit:(null==(i=e.width)?void 0:i.unit)||"",format_thickness_val:(null==(c=e.thickness)?void 0:c.val)||"",format_thickness_unit:(null==(l=e.thickness)?void 0:l.unit)||""};0===e.vendors.length?r.push({...n,...d,vendor_sku:"",vendor_store:"",vendor_name:"",vendor_price_val:"",vendor_price_unit:"",vendor_discontinued:"",vendor_url:""}):e.vendors.forEach(e=>{var t,o;r.push({...n,...d,vendor_sku:e.sku||"",vendor_store:e.store||"",vendor_name:e.name||"",vendor_price_val:(null==(t=e.price)?void 0:t.val)||"",vendor_price_unit:(null==(o=e.price)?void 0:o.unit)||"",vendor_discontinued:e.discontinued||!1,vendor_url:e.url||""})})}),r}function l(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",n=t.replace(/[^a-zA-Z0-9\s-_]/g,"").trim().substring(0,20),r=o.replace(/[^a-zA-Z0-9\s-_]/g,"").trim().substring(0,30),a="".concat(e.toString().padStart(3,"0"));return n&&(a+="_".concat(n)),r&&(a+="_".concat(r)),a.replace(/\s+/g,"_").replace(/_+/g,"_")}async function d(e,t){var o,n;let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"K9 Report",s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},{maxImageWidth:g=800,maxImageHeight:m=600,includeReference:u=!0,onProgress:h}=s;if(0===e.length)throw Error("No favorite products to export");let f=new(r()),p=[],_=e.length+ +!!u,v=e.reduce((e,t)=>e+t.images.length,0)+(u?t.images.length:0),w=0,E=_+v+2,y=e=>{h&&h(w,E,e)};if(u){y("Processing reference product...");let e=c(t,0,"REFERENCE");p.push(...e),w++;let n=l(0,t.brand,t.model),r=f.folder("images/".concat(n,"_REFERENCE"));if(r&&t.images.length>0)for(let e=0;e<t.images.length;e++){let n=t.images[e];try{y("Downloading reference image ".concat(e+1,"/").concat(t.images.length,"..."));let c=await a(n.url),l=await i(c,g,m),d=(null==(o=n.url.split(".").pop())?void 0:o.toLowerCase())||"jpg",s="image_".concat((e+1).toString().padStart(2,"0"),".").concat(d);r.file(s,l)}catch(t){console.error("Failed to download reference image ".concat(e+1,":"),t),r.file("FAILED_image_".concat((e+1).toString().padStart(2,"0"),".txt"),"Failed to download image from: ".concat(n.url,"\nError: ").concat(t instanceof Error?t.message:"Unknown error"))}w++}}for(let t=0;t<e.length;t++){let o=e[t],r=u?t+1:t;y("Processing product ".concat(t+1,"/").concat(e.length,": ").concat(o.brand," ").concat(o.model,"..."));let d=c(o,r,"FAVORITE");p.push(...d),w++;let s=l(r,o.brand,o.model),h=f.folder("images/".concat(s));if(h&&o.images.length>0)for(let e=0;e<o.images.length;e++){let r=o.images[e];try{y("Downloading image ".concat(e+1,"/").concat(o.images.length," for product ").concat(t+1,"..."));let c=await a(r.url),l=await i(c,g,m),d=(null==(n=r.url.split(".").pop())?void 0:n.toLowerCase())||"jpg",s="image_".concat((e+1).toString().padStart(2,"0"),".").concat(d);h.file(s,l)}catch(o){console.error("Failed to download image ".concat(e+1," for product ").concat(t+1,":"),o),h.file("FAILED_image_".concat((e+1).toString().padStart(2,"0"),".txt"),"Failed to download image from: ".concat(r.url,"\nError: ").concat(o instanceof Error?o.message:"Unknown error"))}w++}}y("Generating CSV file...");let b=function(e){if(0===e.length)return"";let t=new Set;e.forEach(e=>{Object.keys(e).forEach(e=>t.add(e))});let o=["row_index",...Array.from(t).filter(e=>"row_index"!==e).sort()],n=[];return n.push(o.map(e=>'"'.concat(e,'"')).join(",")),e.forEach(e=>{let t=o.map(t=>{let o=String(e[t]||"").replace(/"/g,'""');return'"'.concat(o,'"')});n.push(t.join(","))}),n.join("\n")}(p);f.file("products.csv",b),w++;let k="# ".concat(d,' - Favorites Export\n\nThis ZIP file contains:\n\n1. **products.csv** - Product information in CSV format\n   - Row index in first column for easy image identification\n   - Each product may span multiple rows (one per format/vendor combination)\n   - Reference product rows marked with type="REFERENCE"\n   - Favorite product rows marked with type="FAVORITE"\n   - Product info repeated in each row for easy filtering/sorting\n   - Format and vendor details in dedicated columns\n\n2. **images/** folder - Product images organized by folders\n   - Each product has its own folder named: {row_index}_{brand}_{model}\n   - Images are resized to maximum ').concat(g,"x").concat(m,' pixels\n   - Original aspect ratios are maintained\n   - Failed image downloads are noted in FAILED_image_*.txt files\n\nCSV Structure:\n- row_index: Identifies which image folder corresponds to this product\n- type: "REFERENCE" or "FAVORITE" \n- Product details: brand, series, model, category info\n- Format details: length, width, thickness with units\n- Vendor details: SKU, store, name, price, discontinued status, URL\n\nExport Details:\n- Total CSV rows: ').concat(p.length,"\n- Total products: ").concat(e.length+ +!!u,"\n- Reference included: ").concat(u?"Yes":"No","\n- Export date: ").concat(new Date().toISOString(),"\n- Max image dimensions: ").concat(g,"x").concat(m,"\n\nGenerated by K9 Product Search System\n");f.file("README.txt",k),y("Generating ZIP file...");let x=await f.generateAsync({type:"blob",compression:"DEFLATE",compressionOptions:{level:6}});return w++,y("Export complete!"),x}function s(e,t){let o=URL.createObjectURL(e),n=document.createElement("a");n.href=o,n.download=t,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(o)}function g(e){let t=e.replace(/[^a-zA-Z0-9\s-_]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").toLowerCase().substring(0,50).replace(/^-+|-+$/g,"")||"k9-report",o=new Date().toISOString().replace(/[:.]/g,"-").split("T")[0];return"k9-favorites-".concat(t,"-").concat(o,".zip")}}}]);